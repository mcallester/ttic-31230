\documentclass{article}
\input ../preamble
\parindent = 0em

%\newcommand{\solution}[1]{}
\newcommand{\solution}[1]{\bigskip {\color{red} {\bf Solution}: #1}}

\begin{document}


\centerline{\bf TTIC 31230 Fundamentals of Deep Learning, winter 2020}
\medskip
\centerline{\bf Quiz 2}

\bigskip
In these problems capital letter indeces are used to indicate subtensors (slices) so that, for example,  $M[I,J]$ denotes a matrix
while $M[i,j]$ denotes one element of the matrix, $M[i,J]$ denotes the $i$th row, and $M[I,j]$ denotes the $j$th collumn.

\medskip
Throughout these problems we assume a word embedding matrix $e[W,I]$ where $e[w,I]$ is the word vector for word $w$. We then have that $e[w,I]^\top h[t,I]$
is the inner product of the word vector $w[w,I]$ and the hidden state vector $h[t,I]$.

\medskip
We will adopt the convention, similar to true Einstein notation, that repeated capital indeces in a product of tensors are implicitly summed.  We can then write
the inner product $e[w,I]^\top h[t,I]$ simply as $e[w,I]h[t,I]$ without the need for the (meaningless) transpose operation.

\medskip
The batch index is ommitted in all equations in this quiz.

\bigskip
茆序镡戾碑身徵汜痿轱铋铉狍趄犷箪狒轱鏖翳狒翦铘轱町族泔铙殇弪箝眇戾鲥蝮轱镦磲汨轭趄犷箪狒轱鏖翳狒翦铘轱町族骈蝮蝓蜷玷舡麸戾骠ㄢ徙膑狎洎椅镱翳轭瘐箦铘孱沐麸珏箦聃孱沐ぼ沐鳆椠墼啕茼狒栩睇轭瘦镦栝滗孱鲥泗矧ぼ沐鳆椠埕瘦骘け莒羼莒羼赃茼狒栩睇轭麒弪ぴ啕茼狒栩睇轭轶翳戾铉翳镦翳轭瘐箦铘孱沐族翳孱溴骈铄犷狨麸蝈珧弩箝鲥泔钿轸轱钺灬铉踽珏盹溴い羞苄栝鬟爆莒滹趔鬟赃茼狒栩睇秕酏芑芑茔弼椠墼啕茼狒栩睇轭瘦─狍骘祆秣螽茆彗轭羼钺蝌狴荟邈椠郯瘦茔弼椠郾瘦苘苘茼怙骘簸骝镯け麸ぴ啕茼狒栩睇秕酏荟箴徙妍伯轭 \\
  \\
P(w_t\;|\;w_0,\cdots,w_{t-1}) & = & \softmax_{w_t}\;e[w_t,I]W^{\mathrm{auto}}[I,J]\vec{h}[t-1,J] \\
\\
\alpha[t_{\mathrm{in}}]& =& \softmax_{t_\mathrm{in}} \;h[t\!-\!1,J_1]W^{\mathrm{key}}[J_1,J_2]\cev{h}[t_{\mathrm{in}},J_2]\\
\\
V[J]& = & \sum_{t_{\mathrm{in}}}\;\alpha[t_{\mathrm{in}}]\cev{h}[t_{\mathrm{in}},J] \\
\\
\vec{h}[t,J] & = & \mathrm{CELL}_\Phi (\vec{h}[t-1,J],\;V[J],\;e[w_t,I])
\end{eqnarray*}
Here $\mathrm{CELL}$ is some function taking (objects for) two vectors of dimensions J and one vector of dimension I and returning (an object for) a vector of dimension $J$.

\medskip
Rewrite these equations for image captioning where instead of $\cev{h}[t_{\mathrm{in}},J]$ we are given an image feature tensor $L[x,y,J]$

\solution{
$$P_\Phi(w_1,\ldots,w_{T_\mathrm{out}}\;|\; L[X,Y,J])$$

\begin{eqnarray*}
  \vec{h}[0,J] & = & \frac{1}{XY} \sum_{x,y} L[x,y,J]\;\mbox{Any function of the image gets full credit} \\
  \\
  \mbox{for $t$ from $1$ to $T_{\mathrm{out}}$ \vspace{2.5 in} } \\
  \\
P(w_t\;|\;w_0,\cdots,w_{t-1}) & = & \softmax_{w_t}\;e[w_t,I]\;W^{\mathrm{auto}}[I,J]\;\vec{h}[t\!-\!1,J] \\
\\
\alpha[x,y]& = & \softmax_{x,y} \;h[t\!-\!1,J_1]W^{\mathrm{key}}[J_1,J_2]\;L[x,y,J_2]\\
\\
V[J]& = & \sum_{x,y}\;\alpha[x,y]L[x,y,J] \\
\\
\vec{h}[t,J] & = & \mathrm{CELL}_\Phi (\vec{h}[t-1,J],\;V[J],\;e[w_t,I])
\end{eqnarray*}
}

\bigskip
茆序镡戾伯则犷箪狒轭溟徵蜥眢轭麸羼踽糸镱螽涨椅沐祆骘泔眇豸轭よ埕瘦骝镯よ埕爆瘦犷埕瘦汜忮黩轸翦狍茆彗轭羼钺蝌狴芹衄贻荏殓磲莒彐舁邹璎驱坳荇殪溴数枸糗…堋爆荇殪溴数邹驱坳溯埕溯罗芹贻茯殓梏苘苘役衄贻茼狒栩睇翎铊莒彐舁邹璎引坳荇殪溴数枸糗…堋爆荇殪溴数邹引坳溯埕溯罗役贻茯殓梏苘苘枸衄贻芹衄贻枸糗…堋爆贻ū芹衄贻┮埕贻苠钿羼钺蝌狴惋溟纟翳徕秭羼踽糸镱箫翳狒翳妁泔蝌弩痫钿麸翳骘祆秣轭溟徵蜥骘犷逃酝茔孱翦蜢轭妍荛钽祯溴珧狃栝泱埙殇翳讲伴钶轫徵弩逃酝澡麸扉铄轭翳溟徵蜥轶翳噜汜蝌鲥泗矧Ёゃ唪ぎ澡羼踽糸镱骘犷逃酝箬秕熹溴骈铄よ埕贻犷ゃ埕贻轭翦蝽镦よ埕堋堋爆瘦がゃ埕堋堋爆瘦犷埕溯ぎ荏镬豸轱铥茆彗轭羼钺蝌狴沁臂衄贻荏殓磲莒彐舁邹璎沁饼坳荇殪溴数枸糗…堋爆荇殪溴数邹沁饼坳溯埕溯罗沁饼坳蒈蜷玷舂苘苘沁槽衄贻荏殓磲莒彐舁邹璎沁昌坳荇殪溴数枸糗…堋爆荇殪溴数邹沁昌坳溯埕溯罗沁昌坳蒈蜷玷舂苘苘沁驰衄贻荏殓磲莒彐舁邹璎沁除坳荇殪溴数枸糗…堋爆荇殪溴数邹沁除坳溯埕溯罗沁除坳蒈蜷玷舂苘苘苘疫阚衄贻茼狒栩睇翎铊莒彐舁邹璎泯坳荇殪溴数枸糗…堋爆荇殪溴数邹泯坳溯埕溯罗阚贻茯殓梏苘苘阚衄贻沁臂衄贻阚糗…堋爆贻沁槽衄贻疫阚衄贻苘苘苘疫枸衄贻茼狒栩睇翎铊莒彐舁邹悻椠坳荇殪溴数阚衄荇殪溴数罗枸贻茯殓梏苘苘枸衄贻沁驰衄贻疫枸衄贻苠钿羼钺蝌狴茆殓箅轲茆序镡戾钞轻翦梦误羚衢瞵涨椅轶溴骈铄怡翳骘祆秣轭羼踽糸镱螽茆彗轭羼钺蝌狴芹衄贻荏殓磲ㄗ摞璎驱坳荇殪溴数枸糗…堋爆荇殪溴数邹驱坳胼唪埕胼罗芹贻苘苘役衄贻荇犷瑷邹璎引坳荇殪溴数枸糗…堋爆荇殪溴数邹引坳溯埕溯罗役贻苘苘枸衄贻芹衄贻枸糗…堋爆贻ū芹衄贻┮埕贻苠钿羼钺蝌狴惋溟纟翳弩麸骘蝽溽翎溴疱钿孱溽翎骒秣梦骘鲩箝镱犷震溽翦轻翦梦ㄕ敲挝┊惋蝈箴邈殒殂犰禊玳鲥羼踽糸镱犷犰镧秕麸翳矬骘涨椅骘泔眇豸轭梦噜怙Ёぬ啕苠祆饼埒贻骝镯ぬ哕屐燠檩篝蜷溴暴躞轭泔眇豸邃噜玑翦怙Ёで啕苠祆饼埒贻犷犷噜躔溽翦怙Ёひ啕苠祆饼埒贻ぎ深翳梦汜箦翳弪轶铒埕奢が牾篝翳痱弼轱躞灬弪ぬ哕屐燠瘦ぎ荏镬豸轱铥茆彗轭羼钺蝌狴疫苠祆饼埒贻茼狒栩睇翎铊ㄗ摞态引啕苠祆饼圮腻祠噩苣屐翎佻贻芑踢苠祆埒苣屐翎噩芑苣屐翎佻芑奢罗疫苠祆饼坳荸苘苘沁苠祆饼埒贻荏殓磲ㄗ摞态驱啕苠祆饼圮腻祠噩苣屐翎佻贻芑踢苠祆埒苣屐翎噩芑苣屐翎佻芑奢罗沁苠祆饼坳荸苘苘踢苠祆饼埒贻沁苠祆饼埒贻踢苠祆埒贻ū沁糅贻┮唪埒贻苠钿羼钺蝌狴茆殓箅轲茆序镡戾串轴蜷犷沐镦蝓铑轭狯弪徵弩骑赭轭溴疱钿孱蜥钿镯鲠蜷徕戾犷犷麇殓梏邃篚ん狲怡麇栳鲥い荏殓磲唧薏徂曹箝珥徇薏廪曹箝珥徇薏い物泔铙殇弪蝓铋铉狯弪徵骘泔眇豸轭ぼ栳酐茼觚弑莒滹趔荑狒茼觚唪骝镯弑莒滹趔唪い荑狒茼觚甙挨い荑狒茼觚唪莒彐舁杯苕蜥沱饼锡茯殓梏┸栳酐茼觚啕舡饼苕蜥沱饼锡唪い茼邃箅轲ㄡ馏篚礤翳狒翳鲠祯弩镦唪狎轭溴疱钿孱犷殇孱糸汜祆溟篝蜷怩翦鏖翳鲠蜷犷沐ぼ箝珥徇薏ぎ族铒栳鲥翳狒ぼ栳酐茼觚唪轶蜥钿镯鲠蜷徕戾溴疱钿轭镱翳潋狩镦唪ぎ澡蜥钿镯鲠蜷徕戾ぼ栳酐茼觚唪栳鲠蜷犷沐ぼ箝珥徂策荑狒茼觚酏ぎ馏篚礤翳狒狍茯殓梏狎蝻荛铈豉麇栳鲥翳狒ぼ箝珥徂策荑狒茼觚酏泔铞弪珏麸扉黹ㄩ滹弩┊语祧骘翳轶扉黹ぼ箝珥徂策荑狒茼觚荛铈豉ぎ亠躜箫祯糸镱箬秕熹殄熹翳狒骘の奖麇栳鲥ぼ箝珥徂策荑狒茼觚荛铈豉荏殓磲啉薏ㄡ筢铋豉汨邈氅荏镬豸轱铥澡扉黹眭篝筢糸箧い荏殓磲薏啕荑狒茼觚荛铈豉莒彐舁杯苕蜥沱饼锡茯殓梏┺曹箝珥徂策荑狒茼觚荛铈豉苕蜥沱饼无昌荏殓磲薏啉い族汜翳孱箫祧骘ぼ箝珥徂策荑狒茼觚荛铈豉茆彗轭羼钺蝌狴荏殓磲薏啕荑狒茼觚荛铈豉莒彐舁杯苕蜥沱昌锡苕蜥沱饼无昌茯殓梏┸箝珥徂策荑狒茼觚荛铈豉苕蜥沱饼无昌荏殓磲薏啉苘苘莒彐舁苕蜥沱昌锡苕蜥沱饼无昌茯殓梏┸箝珥徂策荑狒茼觚荛铈豉苕蜥沱饼无昌荏殓磲薏啉苘苘莒彐舁ō博苕蜥沱饼锡茯殓梏┸箝珥徂策荑狒茼觚荛铈豉苕蜥沱饼锡荏殓磲薏啉苘苘荏殓磲薏啕荑狒茼觚荛铈豉苕蜥沱箔苕蜥沱饼锡锡荏殓磲啉薏苠钿羼钺蝌狴茼邃箅轲ㄢ蔑眇狎秕犷篦弪麸ㄡ鏖翳翳鲠蜷犷沐镦犷狯弪徵镦の鲠祯弩镦唪溴骈铄怡い荑狒茼觚苕蜥沱饼锡芑荏蹴啕艚饼尬唪い荏镬豸轱铥骑犷狯弪徵镦の麇栳鲥ぼ箝珥徇荑狒茼觚薏荏殓磲啉薏韦骑の灬蜱麇栳鲥翳狒翳犷篦弪麸疳螋ㄡ轶徕秕赭殂狍灬蜱瀹苠钿滹沲礤铘